local functions =
    loadstring(game:HttpGet("https://github.com/localplayerr/Doors-stuff/raw/refs/heads/main/Functions"))()

function LoadCustomInstance(url, Name)
    if not isfile(Name .. ".rbxm") then
        writefile(Name .. ".rbxm", game:HttpGet(url))
    end

    return game:GetObjects(getcustomasset(Name .. ".rbxm", true))[1]
end

function LoadCustomSound(url, Name)
    if not isfile(Name .. ".mp3") then
        writefile(Name .. ".mp3", game:HttpGet(url))
    end

    return getcustomasset(Name .. ".mp3", true)
end

task.spawn(functions.TitleLocation, "The Whiteout", 5)
game.Lighting.FogEnd = 150
game.Lighting.FogStart = 3
game.Lighting.FogColor = Color3.fromRGB(255, 255, 255)
local wh = Instance.new("ColorCorrectionEffect", game.Lighting)
wh.TintColor = Color3.fromRGB(150, 180, 255)
wh.Contrast = 2
wh.Brightness = 1

game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()

task.wait(2.5)

function MoveTo(cframe, speed, model)
    local reached = false
    local connection
    connection =
        game:GetService("RunService").Stepped:Connect(
        function(_, step)
            local pivot = model:GetPivot()
            local difference = (cframe.Position - pivot.Position)
            local unit = difference.Unit
            local magnitude = difference.Magnitude

            if magnitude > 0.1 then
                model:PivotTo(pivot + unit * math.min(step * speed, magnitude))
            else
                connection:Disconnect()
                reached = true
            end
        end
    )
    repeat
        game:GetService("RunService").Stepped:Wait()
    until reached
end

local FogModel =
    LoadCustomInstance(
    "https://github.com/localplayerr/Doors-stuff/raw/refs/heads/main/Mayhem%20mode%20recreate/Foggy.rbxm",
    "Foggy_model"
)
local entity = FogModel.FogMonster
FogModel.Parent = game.workspace

local room = game.Workspace.CurrentRooms["50"]
entity.CFrame = room.RoomExit.CFrame
local nodes = room.FigureSetup:FindFirstChild("FigureNodes")

room.FigureSetup.Ambience:Destroy()
function LoadCustomSound(url, Name)
    if not isfile(Name .. ".mp3") then
        writefile(Name .. ".mp3", game:HttpGet(url))
    end

    return getcustomasset(Name .. ".mp3", true)
end

local Ambience = Instance.new('Sound',game.Workspace)
Ambience.SoundId = LoadCustomSound("https://github.com/localplayerr/Doors-stuff/raw/refs/heads/main/Mayhem%20mode%20recreate/Calm.MP3","Calm")
Ambience.Looped = true

task.spawn(function()
	task.wait(3)
	Ambience:Play()
end)

task.spawn(
    function()
        while task.wait() do
            local distance = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - entity.Position).Magnitude
            if distance < 75 then
                local magnet = 3 / 75 * (75 - distance)
                local roght = 20 / 75 * (75 - distance)
                require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).camShaker:ShakeOnce(
                    magnet,
                    roght,
                    0.1,
                    1
                )
            end
            local ray =
                game.Workspace:Raycast(
                entity.Position,
                (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - entity.Position).Unit * 50
            )
            if ray then
                if
                    ray.Instance.Parent == game.Players.LocalPlayer.Character and
                        game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false or
                        ray.Instance.Parent.Parent == game.Players.LocalPlayer.Character and
                            game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false
                 then
                    game.Players.LocalPlayer.Character.Humanoid.Health = 0
                    firesignal(
                        game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent,
                        {
                            "Oh... hello.",
                            "Not this place again...",
                            "Nevermind that... What'd you die to?",
                            "Ohâ€¦ the white one.",
                            "It usually hiden in fog, so...",
                            "Maybe you could call it Fog?",
                            "Anyways, I hope you don't mind trying again. It would ne helpful."
                        },
                        "Yellow"
                    )
                    game.ReplicatedStorage.GameStats["Player_" .. game.Players.LocalPlayer.Name].Total.DeathCause.Value =
                        "Fog"
                end
            end
        end
    end
)

task.spawn(
    function()
        while FogModel.Parent do
            if nodes then
                for i = 1 , #nodes:GetChildren() , 1 do
		    local node = nodes:GetChildren()[i]
                    if node then
                        MoveTo(node.CFrame + Vector3.new(0, 4, 0), 25, entity)
                    end
                end
            end
            task.wait()
        end
    end
)

game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()
game.Lighting.FogEnd = 10000
game.Lighting.FogStart = 0
game.Lighting.FogColor = Color3.fromRGB(0, 0, 0)
FogModel:Destroy()
wh:Destroy()
Ambience:Destroy()
