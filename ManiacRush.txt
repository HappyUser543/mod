function LoadCustomInstance(url, Name)
    if not isfile(Name .. '.rbxm') then
        writefile(Name .. '.rbxm', game:HttpGet(url))
    end

    return game:GetObjects(getcustomasset(Name .. '.rbxm', true))[1]
end

function LoadCustomSound(url, Name)
    if not isfile(Name .. '.mp3') then
        writefile(Name .. '.mp3', game:HttpGet(url))
    end

    return getcustomasset(Name .. '.mp3', true)
end

function MoveTo(cframe, speed, model)
    local reached = false
    local connection
    connection = game:GetService('RunService').Stepped:Connect(function(_, step)
        local pivot = model:GetPivot()
        local difference = (cframe.Position - pivot.Position)
        local unit = difference.Unit
        local magnitude = difference.Magnitude

        if magnitude > 0.1 then
            model:PivotTo(pivot + unit * math.min(step * speed, magnitude))
        else
            connection:Disconnect()
            reached = true
        end
    end)
    repeat
        game:GetService('RunService').Stepped:Wait()
    until reached
end

local Rooms = game.Workspace.CurrentRooms

local ManiacRushModel = LoadCustomInstance(
    'https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/NMRush.rbxm',
    'Maniacrush_model'
)
ManiacRushModel.Parent = game.Workspace

local Rush = ManiacRushModel.RushNew
Rush.Anchored = true

--Rush.PlaySound.SoundId = LoadCustomSound(
    'https://github.com/localplayerr/Doors-stuff/raw/refs/heads/main/Mayhem%20mode%20recreate/ManiacRushMoving2.mp3',
    'ManiacRushMoving2'
)
Rush.PlaySound.PlaybackSpeed = 1
for _, inst in Rush.PlaySound:GetChildren() do
    inst:Destroy()
end
Rush.Footsteps.Playing = false

for _, v in game.Workspace.CurrentRooms:GetChildren() do
    task.spawn(function()
        require(game.ReplicatedStorage.ModulesClient.Module_Events).flicker(
            v,
            2
        )
    end)
end

Rush.CFrame = Rooms:GetChildren()[1]:WaitForChild("RoomEntrance").CFrame
Rush.Anchored = true

task.wait(2)
Rush.Footsteps:Play()
task.wait(1)

task.spawn(function()
    while ManiacRushModel.Parent and task.wait() do
        local distance = (
            game.Players.LocalPlayer.Character.HumanoidRootPart.Position
            - Rush.Position
        ).magnitude
        if distance < 100 then
            require(
                game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game
            ).camShaker:ShakeOnce(
                2 / 100 * (100 - distance),
                20 / 100 * (100 - distance),
                0.1,
                1
            )
        end
        local ray = game.Workspace:Raycast(
            Rush.Position,
            (
                game.Players.LocalPlayer.Character.HumanoidRootPart.Position
                - Rush.Position
            ).Unit * 50
        )
        if ray then
            if
                ray.Instance.Parent
                        == game.Players.LocalPlayer.Character
                    and game.Players.LocalPlayer.Character:GetAttribute(
                        'Hiding'
                    ) == false
                or ray.Instance.Parent.Parent
                        == game.Players.LocalPlayer.Character
                    and game.Players.LocalPlayer.Character:GetAttribute(
                        'Hiding'
                    ) == false
            then
                game.Players.LocalPlayer.Character.Humanoid.Health = 0
                game.ReplicatedStorage.GameStats['Player_' .. game.Players.LocalPlayer.Name].Total.DeathCause.Value =
                    'Maniac Rush'
            end
        end
    end
end)

for u = 1, #Rooms:GetChildren(), 1 do
    local Room = Rooms:GetChildren()[u]
    if Room then
        require(game.ReplicatedStorage.ModulesClient.Module_Events).shatter(
        Room
        )
        local WayPoints = Room:FindFirstChild('PathFindNodes')
        if WayPoints then
            WayPoints = WayPoints:GetChildren()
            for _, Point in WayPoints do
                if not Point.Parent then
                    continue
                end
                MoveTo(Point.CFrame + Vector3.new(0,4,0), 85, Rush)
            end
        end
        if Room:FindFirstChild('RoomExit') then
            MoveTo(Room.RoomExit.CFrame, 85, Rush)
        end
    end
end
task.wait(8)
for u = #Rooms:GetChildren(), 1, -1 do
    local Room = Rooms:GetChildren()[u]
    if Room then
        local WayPoints = Room:FindFirstChild('PathFindNodes')
        if WayPoints then
            WayPoints = WayPoints:GetChildren()
            table.sort(WayPoints, function(a, b)
                return tonumber(a.Name) > tonumber(b.Name)
            end)
            for _, Point in WayPoints do
                if not Point.Parent then
                    continue
                end
                MoveTo(Point.CFrame + Vector3.new(0,4,0), 85, Rush)
            end
        end
        if Room:FindFirstChild('RoomExit') then
            MoveTo(Room.RoomEntrance.CFrame, 85, Rush)
        end
    end
end

ManiacRushModel:Destroy()








