if game.Workspace:FindFirstChild("SeekMovingNewClone") then
    return
end

function LoadCustomInstance(url, Name)
    if not isfile(Name .. ".rbxm") then
        writefile(Name .. ".rbxm", game:HttpGet(url))
    end

    return game:GetObjects(getcustomasset(Name .. ".rbxm", true))[1]
end

function MoveTo(cframe, speed, model)
    local reached = false
    local connection
    connection =
        game:GetService("RunService").Stepped:Connect(
        function(_, step)
            local pivot = model:GetPivot()
            local difference = (cframe.Position - pivot.Position)
            local unit = difference.Unit
            local magnitude = difference.Magnitude

            if magnitude > 0.1 then
                model:PivotTo(pivot + unit * math.min(step * speed, magnitude))
            else
                connection:Disconnect()
                reached = true
            end
        end
    )
    repeat
        game:GetService("RunService").Stepped:Wait()
    until reached
end

local Rooms = game.Workspace.CurrentRooms

local ManiacAmbushModel =
    LoadCustomInstance(
    "https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/NMAmbush.rbxm",
    "Maniac_ambush"
)
ManiacAmbushModel.Parent = game.Workspace

local Ambush = ManiacAmbushModel.AmbushNew
Ambush.Anchored = true

local s = Instance.new("Sound", game.Workspace)
s.SoundId = "rbxassetid://134020218579308"
s.PlaybackSpeed = 0.8
s:Play()

task.wait(4)

Ambush.CFrame = Rooms:GetChildren()[1]:WaitForChild("RoomEntrance").CFrame

task.spawn(
    function()
        while ManiacAmbushModel.Parent and task.wait() do
            local distance = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - Ambush.Position).magnitude
            if distance < 100 then
                require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).camShaker:ShakeOnce(
                    2 / 100 * (100 - distance),
                    20 / 100 * (100 - distance),
                    0.1,
                    1
                )
            end
            local ray =
                game.Workspace:Raycast(
                Ambush.Position,
                (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - Ambush.Position).Unit * 50
            )
            if ray then
                if
                    ray.Instance.Parent == game.Players.LocalPlayer.Character and
                        game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false or
                        ray.Instance.Parent.Parent == game.Players.LocalPlayer.Character and
                            game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false
                 then
                    game.Players.LocalPlayer.Character.Humanoid.Health = 0
                    game.ReplicatedStorage.GameStats["Player_" .. game.Players.LocalPlayer.Name].Total.DeathCause.Value =
                        "Maniac Ambush"
                end
            end
        end
    end
)

for i = 1, 6 do
    for u = 1, #Rooms:GetChildren(), 1 do
        local Room = Rooms:GetChildren()[u]
        if Room then
            local WayPoints = Room:FindFirstChild("PathFindNodes")
            if WayPoints then
                WayPoints = WayPoints:GetChildren()
                for i = 1, #WayPoints:GetChildren(), 1 do
                    local Point = WayPoints[i]
                    if Point then
                        MoveTo(Point.CFrame + Vector3.new(0, 4, 0), 170, Ambush)
                    end
                end
            end
            if Room:FindFirstChild("RoomExit") then
                MoveTo(Room.RoomExit.CFrame, 170, Ambush)
            end
        end
    end
    for u = #Rooms:GetChildren(), 1, -1 do
        local Room = Rooms:GetChildren()[u]
        if Room then
            local WayPoints = Room:FindFirstChild("PathFindNodes")
            if WayPoints then
                WayPoints = WayPoints:GetChildren()
                table.sort(
                    WayPoints,
                    function(a, b)
                        return tonumber(a.Name) > tonumber(b.Name)
                    end
                )
                for i = 1, #WayPoints, 1 do
                    local Point = WayPoints[i]
                    if Point then
                        MoveTo(Point.CFrame + Vector3.new(0, 4, 0), 170, Ambush)
                    end
                end
            end
            if Room:FindFirstChild("RoomEntrance") then
                MoveTo(Room.RoomEntrance.CFrame, 170, Ambush)
            end
        end
    end
    task.wait(2)
end

ManiacAmbushModel:Destroy()
